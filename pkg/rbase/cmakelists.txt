cmake_minimum_required(VERSION 3.12)
project(rbase  VERSION 0.1.0  LANGUAGES C)

include(../../ckit.cmake)
ckit_configure_project(C)

add_library(rbase
  debug.c
  fs.c
  hash.c
  mem.c
  mem_arena.c
  mem_linear.c
  mem_page.c
  os_exepath.c
  os_getcwd.c
  os_stacktrace.c
  panic.c
  parseint.c
  path.c
  str.c
  sys_ncpu.c
  testing.c
  thread.c
  time.c
  unicode.c
  util.c
  util_io.c
  util_sha1.c

  # extras
  mpscq/mpscq.c
  pool/pool.c
)

# backtrace
if (NOT (${CMAKE_BUILD_TYPE} MATCHES "Debug"))
  # for non-debug builds, disable -llzma and -lz
  set(BACKTRACE_DISABLE_LIB_LZMA 1)
  set(BACKTRACE_DISABLE_LIB_Z 1)
endif()
add_subdirectory(backtrace EXCLUDE_FROM_ALL)
if(BACKTRACE_SUPPORTED)
  target_link_libraries(rbase PRIVATE backtrace)
  target_compile_definitions(rbase PRIVATE HAVE_LIBBACKTRACE)
endif()


ckit_define_test(rbase)

# precompile the main header to speed up uses in other projects
target_precompile_headers(rbase PUBLIC rbase.h)
